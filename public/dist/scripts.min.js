"use strict";angular.module("profileApp",["ngStorage","ui.router"]),function(){function authConfig($httpProvider){$httpProvider.interceptors.push(function($q,$injector,$localStorage){return{request:function(config){return config.headers=config.headers||{},$localStorage.token&&(config.headers.Authorization="Bearer "+$localStorage.token),config},responseError:function(response){var invalidTokenMessages=["INVALID_TOKEN","NO_TOKEN_PROVIDED"],state=$injector.get("$state");return 403===response.status&&invalidTokenMessages.indexOf(response.data.message)>=0&&state.go("login",{errorMessage:"Please, login first."}),$q.reject(response)}}})}angular.module("profileApp").config(authConfig)}(),angular.module("profileApp").run(["$templateCache",function($templateCache){$templateCache.put("routes/login/login.template.html",'<h1>Login</h1>\n\n<div class="alert alert-danger" ng-show="error">{{error}}</div>\n\n<form ng-submit="login()">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Username" ng-model="user.email">\n  </div>\n\n  <div class="form-group">\n    <input type="password" class="form-control" placeholder="Password" ng-model="user.password">\n  </div>\n\n  <button type="submit" class="btn btn-default">Sign in</button>\n</form>\n'),$templateCache.put("routes/user/profile/profile.template.html",'<button ng-click="logout()" class="btn btn-default">Logout</button>\n\n<a ui-sref="profile.show" class="btn btn-info">Me</a>\n<a ui-sref="profile.edit" class="btn btn-primary">Edit profile</a>\n\n<div ui-view></div>\n'),$templateCache.put("routes/user/profile/edit/profile-edit.template.html",'<h1>Edit profile {{user.email}}</h1>\n<button class="btn btn-default" ng-click="save()">Save</button>\n'),$templateCache.put("routes/user/profile/show/profile-show.template.html","<h1>Profile of {{user.email}}</h1>\n")}]),function(){angular.module("profileApp").constant("apiConstant",{url:""})}(),function(){function routes($urlRouterProvider){$urlRouterProvider.otherwise("/login")}angular.module("profileApp").config(routes)}(),function(){function LoginController($scope,$state,authService,$stateParams){$scope.user={},$scope.error=$stateParams.errorMessage,$scope.login=function(){authService.login($scope.user).then(function(res){$state.go("profile.show",{successMessage:"Welcome back!"})})["catch"](function(res){switch(res.data.message){case"WRONG_EMAIL_OR_PASSWORD":$scope.error="Wrong email or password.";break;case"NO_EMAIL_OR_PASSWORD_PROVIDED":$scope.error="Please, provide email and password."}})}}angular.module("profileApp").controller("LoginController",LoginController)}(),function(){function routes($stateProvider){$stateProvider.state("login",{url:"/login",templateUrl:"javascripts/routes/login/login.template.html",controller:"LoginController"})}angular.module("profileApp").config(routes)}(),function(){function authService($http,$localStorage,apiConstant){var apiUrl=apiConstant.url;this.login=function(user){return $http.post(apiUrl+"/users/authenticate",user).then(function(res){return $localStorage.token=res.data.token,res})},this.logout=function(){$localStorage.token=null},this.getUserLoggedIn=function(){return $http.get(apiUrl+"/users/logged-in").then(function(user){return user.data})}}angular.module("profileApp").service("authService",authService)}(),function(){function ProfileController($scope,$state,authService,userLoggedIn){$scope.user=userLoggedIn,$scope.logout=function(){authService.logout(),$state.go("login")}}angular.module("profileApp").controller("ProfileController",ProfileController)}(),function(){function routes($stateProvider){var userResolve={userLoggedIn:function(authService){return authService.getUserLoggedIn()}};$stateProvider.state("profile",{url:"/profile",resolve:userResolve,"abstract":!0,controller:"ProfileController",templateUrl:"javascripts/routes/user/profile/profile.template.html"}).state("profile.show",{url:"",templateUrl:"javascripts/routes/user/profile/show/profile-show.template.html",controller:"ProfileShowController"}).state("profile.edit",{url:"/edit",templateUrl:"javascripts/routes/user/profile/edit/profile-edit.template.html",controller:"ProfileEditController"})}angular.module("profileApp").config(routes)}(),function(){function ProfileEditController($scope,$state){$scope.save=function(){$state.go("profile.show")}}angular.module("profileApp").controller("ProfileEditController",ProfileEditController)}(),function(){function ProfileShowController($scope,$stateParams,$state){}angular.module("profileApp").controller("ProfileShowController",ProfileShowController)}();